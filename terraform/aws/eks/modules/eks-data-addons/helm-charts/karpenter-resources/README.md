# Karpenter Resources Helm Chart

## Overview

This Helm chart is an abstraction layer designed for deploying various configurations of Karpenter nodes in a Kubernetes cluster managed by EKS. It integrates seamlessly with Terraform, allowing users to define different node pools and settings for their Kubernetes cluster.

## Prerequisites

- Helm 3.x or later installed
- Terraform installed
- Access to an AWS EKS cluster

## Configuration

The chart is configured to be used with Terraform. Here is an example of how you might define Helm releases for different Karpenter configurations in your Terraform files using EKS Blueprints add-ons:

```hcl
module "eks_blueprints_addons" {
    # ... other configurations ...
    helm_releases = {
    karpenter-resources-default = {
      name        = "default"
      description = "A Helm chart for default node pool"
      chart       = "${path.module}/helm-values/karpenter-resources"
      values = [
        <<-EOT
      clusterName: ${module.eks.cluster_name}
      ec2NodeClass:
        karpenterRole: ${split("/", module.eks_blueprints_addons.karpenter.node_iam_role_arn)[1]}
      nodePool:
        labels:
          - provisioner: default
          - workload: rayhead
      EOT
      ]
    }
    }
}
```

## Testing the Chart with Helm Template

To review the Kubernetes manifests that will be generated by the Helm chart based on your configuration, you can use the `helm template` command. This is especially useful for validating your Terraform configurations before applying them.

1. **Generate the Manifests**

    Navigate to the directory where your Helm chart is located.

    ```sh
    cd path/to/helm-chart
    ```

2. **Run Helm Template**

    Use the `helm template` command with your custom values. For example:

    ```sh
    helm template my-release-name . --values values.yaml
    ```

    Replace `my-release-name` with a name for your release, and `values.yaml` with the path to your custom values file.

    To test specific configurations defined in your Terraform file, you can create a temporary values file with the configuration snippet from your Terraform definition:

    ```sh
    echo '<your Terraform values here>' > temp-values.yaml
    helm template my-release-name . --values temp-values.yaml
    rm temp-values.yaml
    ```

    This will output the Kubernetes manifests to your terminal, allowing you to review them.
